<div class="reservation-container">
  <!-- Loading spinner -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
  </div>

  <!-- Error message -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
      <button class="btn btn-link" (click)="loadProduit(produit?.id || 0)" *ngIf="produit">
        Réessayer
      </button>
    </div>
  </div>

  <!-- Main content -->
  <div *ngIf="!loading && !error && produit" class="main-content">
    <!-- Header -->
    <div class="header-section">
      <h1>Réservation de Véhicule</h1>
      <div class="section-line"></div>
      <p class="subtitle">Réservez votre véhicule en quelques clics</p>
    </div>

    <div class="content-grid">
      <!-- Section Véhicule -->
      <div class="vehicle-section">
        <div class="vehicle-card">
          <div class="vehicle-image">
            <img [src]="produit?.imageUrl" [alt]="produit?.nom" />
            <div class="price-badge">{{ produit?.prix }}€/jour</div>
          </div>

          <div class="vehicle-details">
            <div class="vehicle-header">
              <div class="vehicle-info">
                <h2>{{ produit?.nom }}</h2>
                <p class="vehicle-brand">{{ produit?.marque }} • {{ produit?.annee }}</p>
              </div>
              <div class="availability">
                <div class="availability-label">Disponible</div>
                <div class="availability-count">{{ produit?.quantite }} véhicules</div>
              </div>
            </div>

            <p class="vehicle-description">{{ produit?.description }}</p>

            <!-- Caractéristiques -->
            <div class="characteristics-grid">
              <div class="characteristic-item">
                <i class="fas fa-car"></i>
                <div>
                  <div class="characteristic-label">Catégorie</div>
                  <div class="characteristic-value">{{ produit.categorie }}</div>
                </div>
              </div>
              <div class="characteristic-item">
                <i class="fas fa-palette"></i>
                <div>
                  <div class="characteristic-label">Couleur</div>
                  <div class="characteristic-value">{{ produit.couleur || 'Non spécifiée' }}</div>
                </div>
              </div>
              <div class="characteristic-item">
                <i class="fas fa-users"></i>
                <div>
                  <div class="characteristic-label">Passagers</div>
                  <div class="characteristic-value">5 personnes</div>
                </div>
              </div>
              <div class="characteristic-item">
                <i class="fas fa-gas-pump"></i>
                <div>
                  <div class="characteristic-label">Carburant</div>
                  <div class="characteristic-value">Essence</div>
                </div>
              </div>
            </div>

            <!-- Avantages inclus -->
            <div class="advantages-section">
              <h3>Inclus dans votre location</h3>
              <div class="advantages-list">
                <div class="advantage-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Assurance tous risques</span>
                </div>
                <div class="advantage-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Kilométrage illimité</span>
                </div>
                <div class="advantage-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Assistance 24h/24</span>
                </div>
                <div class="advantage-item">
                  <i class="fas fa-check-circle"></i>
                  <span>GPS inclus</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section Réservation -->
      <div class="reservation-section">
        <div class="reservation-card">
          <h3>Détails de la réservation</h3>

          <!-- Sélection des dates -->
          <div class="form-section">
            <h4>
              <i class="fas fa-calendar"></i>
              Période de location
            </h4>

            <div class="date-inputs">
              <div class="date-input-group">
                <label>Date de départ</label>
                <input
                  type="text"
                  [value]="formatFromString(selectedDates.dateDepart)"
                  (click)="toggleCalendar('dateDepart')"
                  placeholder="Sélectionner la date"
                  readonly
                  class="date-input"
                />

                <input
                  type="text"
                  [value]="formatFromString(selectedDates.dateRetour)"
                  (click)="toggleCalendar('dateRetour')"
                  placeholder="Sélectionner la date"
                  readonly
                  class="date-input"
                />

              </div>
            </div>

            <!-- Calendrier -->
            <div *ngIf="showCalendar" class="calendar-container">
              <div class="calendar-header">
                <button type="button" (click)="previousMonth()" class="calendar-nav-btn">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <h5>{{ monthNames[currentMonth.getMonth()] }} {{ currentMonth.getFullYear() }}</h5>
                <button type="button" (click)="nextMonth()" class="calendar-nav-btn">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>

              <div class="calendar-days-header">
                <div *ngFor="let day of dayNames" class="calendar-day-name">{{ day }}</div>
              </div>

              <div class="calendar-days">
                <button
                  *ngFor="let day of getDaysInMonth(currentMonth)"
                  type="button"
                  (click)="day.isCurrentMonth && !isDateDisabled(day.date) && handleDateSelect(day.date, showCalendar!)"
                  [class]="'calendar-day ' +
                    (day.isCurrentMonth ? 'current-month' : 'other-month') + ' ' +
                    (isDateSelected(day.date, showCalendar!) ? 'selected' : '') + ' ' +
                    (isDateDisabled(day.date) ? 'disabled' : '')"
                  [disabled]="!day.isCurrentMonth || isDateDisabled(day.date)"
                >
                  {{ day.date.getDate() }}
                </button>
              </div>
            </div>
          </div>

          <!-- Informations personnelles -->
          <div class="form-section">
            <h4>Vos informations</h4>
            <div class="form-row">
              <div class="form-group">
                <label>Nom</label>
                <input
                  type="text"
                  [(ngModel)]="reservationData.nom"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label>Prénom</label>
                <input
                  type="text"
                  [(ngModel)]="reservationData.prenom"
                  class="form-control"
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Téléphone</label>
                <input
                  type="tel"
                  [(ngModel)]="reservationData.telephone"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input
                  type="email"
                  [(ngModel)]="reservationData.email"
                  class="form-control"
                  required
                />
              </div>
            </div>
          </div>

          <!-- Lieux de prise et retour -->
          <div class="form-section">
            <h4>
              <i class="fas fa-map-marker-alt"></i>
              Lieux de prise et retour
            </h4>
            <div class="form-group">
              <label>Lieu de prise en charge</label>
              <select [(ngModel)]="reservationData.lieuPrise" class="form-control" required>
                <option value="">Sélectionner un lieu</option>
                <option *ngFor="let lieu of lieux" [value]="lieu.value">{{ lieu.label }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Lieu de retour</label>
              <select [(ngModel)]="reservationData.lieuRetour" class="form-control" required>
                <option value="">Sélectionner un lieu</option>
                <option *ngFor="let lieu of lieux" [value]="lieu.value">{{ lieu.label }}</option>
              </select>
            </div>
          </div>

          <!-- Récapitulatif -->
          <div *ngIf="selectedDates.dateDepart && selectedDates.dateRetour && nombreJours > 0" class="summary-section">
            <h4>Récapitulatif</h4>
            <div class="summary-details">
              <div class="summary-row">
                <span>Véhicule:</span>
                <span class="summary-value">{{ produit.nom }}</span>
              </div>
              <div class="summary-row">
                <span>Période:</span>
                <span class="summary-value">{{ nombreJours }} jour(s)</span>
              </div>
              <div class="summary-row">
                <span>Prix par jour:</span>
                <span class="summary-value">{{ produit.prix }}€</span>
              </div>
              <div class="summary-row summary-total">
                <span>Total:</span>
                <span class="summary-value">{{ prixTotal }}€</span>
              </div>
            </div>
          </div>

          <!-- Message d'erreur -->
          <div *ngIf="error" class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            {{ error }}
          </div>

          <!-- Bouton de réservation -->
          <button
            type="button"
            (click)="onSubmit()"
            [disabled]="!isFormValid || submitting"
            class="reservation-btn"
            [class.loading]="submitting"
          >
            <span *ngIf="!submitting">Confirmer la réservation</span>
            <span *ngIf="submitting">
              <i class="fas fa-spinner fa-spin"></i>
              Traitement en cours...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
